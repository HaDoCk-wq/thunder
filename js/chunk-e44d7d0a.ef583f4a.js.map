{"version":3,"sources":["webpack:///./src/views/groupsChat.vue?47b1","webpack:///./src/views/groupsChat.vue","webpack:///./src/views/groupsChat.vue?2d5e"],"names":["class","style","xmlns","width","height","fill","viewBox","fill-rule","d","ref","type","$store","getters","name","desc","mesages","mesage","i","key","src","alt","sender","formatMessageData","timestamp","content","loading","emit","message","maxlength","placeholder","currentChannel","data","streams","newStream","typing","peervue","peers","sockets","connect","console","log","newMessage","this","push","methods","$socket","$route","params","id","axios","post","headers","authorization","window","localStorage","token","then","response","warn","catch","error","populateMessages","get","Authorization","messages","$refs","afterChat","scrollIntoView","currentDate","startOf","fromNow","showTyping","setTimeout","peer","commit","mounted","updated","behavior","created","computed","chatId","watch","oldUser","render","__scopeId"],"mappings":"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","file":"js/chunk-e44d7d0a.ef583f4a.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./groupsChat.vue?vue&type=style&index=0&id=6f7db287&scoped=true&lang=css\"","<template>\n    <div class=\"h-100 w-100\">\n        <div\n            class=\"w-100 h-100 d-flex\"\n            style=\"flex-direction: column; overflow: auto\"\n        >\n            <div\n                class=\"p-2 d-flex top-bar\"\n                :class=\"!$store.getters['inCall'] ? 'sticky-top' : ''\"\n            >\n                <div class=\"me-4\">\n                    <strong class=\"mt-2 title-name\">\n                        {{ $store.getters[\"currentGroup\"].name }}\n                    </strong>\n                    <br />\n                    <div>\n                        {{ $store.getters[\"currentGroup\"].desc }}\n                    </div>\n                </div>\n\n                <div class=\"flex-fill\"></div>\n                <div class=\"p-2\">\n                    <div\n                        class=\"top-button\"\n                        @click=\"\n                            $store.commit('userEnterCall');\n                            $router.push(\n                                '/channels/groups/call/' + $route.params.id\n                            );\n                        \"\n                    >\n                        <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            width=\"22\"\n                            height=\"22\"\n                            fill=\"currentColor\"\n                            class=\"bi bi-telephone-fill\"\n                            viewBox=\"0 0 16 16\"\n                        >\n                            <path\n                                fill-rule=\"evenodd\"\n                                d=\"M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z\"\n                            />\n                        </svg>\n                    </div>\n                </div>\n            </div>\n            <div\n                class=\"d-flex p-2 h-100 chat-wrapper flex-fill\"\n                style=\"flex-direction: column; overflow: auto\"\n            >\n                <div\n                    v-for=\"(mesage, i) in mesages\"\n                    :key=\"i\"\n                    class=\"p-2 message\"\n                >\n                    <div class=\"d-flex\">\n                        <img\n                            :src=\"\n                                $store.getters['api'] +\n                                '/profiles/' +\n                                mesage.sender.image\n                            \"\n                            height=\"50\"\n                            width=\"50\"\n                            alt=\"Profile image\"\n                            class=\"rounded-circle me-3\"\n                        />\n                        <div class=\"text-break\" style=\"white-space: pre-wrap\">\n                            <div class=\"mb-1 d-flex\">\n                                <div class=\"me-3\">\n                                    <strong>{{ mesage.sender.name }}</strong>\n                                </div>\n                                <div\n                                    class=\"text-muted mt-0\"\n                                    style=\"font-size: 15px\"\n                                >\n                                    {{ formatMessageData(mesage.timestamp) }}\n                                </div>\n                            </div>\n                            <div class=\"mt-1\">\n                                {{ mesage.content }}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div ref=\"afterChat\"></div>\n            </div>\n            <div\n                v-if=\"loading\"\n                class=\"progress-line border-progress-line\"\n            ></div>\n            <div class=\"w-100 wrapper-input\">\n                <form @submit.prevent=\"emit\" class=\"d-flex flex-wrap\">\n                    <input\n                        v-model=\"message\"\n                        type=\"text\"\n                        class=\"me-2 flex-fill input-mesage\"\n                        maxlength=\"1000\"\n                        :placeholder=\"' Chat with ' + currentChannel.name\"\n                    />\n                    <button type=\"submit\" class=\"btn btn-primary\">Send</button>\n                </form>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport moment from \"moment\";\n//import Peer from \"peerjs\";\n\nexport default {\n    data: function () {\n        return {\n            message: \"\",\n            mesages: [],\n            loading: false,\n            currentChannel: {},\n            streams: {},\n            newStream: null,\n            typing: 0,\n            peervue: null,\n            peers: {},\n        };\n    },\n    sockets: {\n        connect: function () {\n            console.log(\"socket connected\");\n        },\n        newMessage: function (data) {\n            console.log(\"el server diu\", data);\n            this.mesages.push(data);\n        },\n        // \"user-conected\": function(data) {\n        //   console.log(\"user conected\", data);\n        // },\n        // \"user-conected\": function(userId) {\n        //   const call = peer.call(userId, stream);\n        //   const video = document.createElement(\"video\");\n        //   call.on(\"stream\", (userVideoStream) => {\n        //     this.streams.push(userVideoStream);\n        //   });\n        //   call.on(\"close\", () => {\n        //     video.remove();\n        //   });\n\n        //   peers[userId] = call;\n\n        //   //   call.on(\"close\", (userVideoStream) => {\n        //   //     //this.streams = [];\n        //   //     // for (const stream of this.streams) {\n        //   //     //     if (stream.userId != userId) {\n        //   //     //         this.streams.push({\n        //   //     //             stream: userVideoStream,\n        //   //     //             id: userId,\n        //   //     //         });\n        //   //     //     }\n        //   //     // }\n        //   //     console.log(userVideoStream);\n        //   //   });\n        // },\n    },\n    methods: {\n        emit() {\n            if (this.message != \"\") {\n                this.$socket.emit(\n                    \"message\",\n                    this.$route.params.id,\n                    this.message,\n                    this.$store.getters[\"user\"]\n                );\n\n                this.axios\n                    .post(\n                        this.$store.getters[\"api\"] +\n                            \"/messages/add/\" +\n                            this.$route.params.id,\n                        {\n                            message: this.message,\n                        },\n                        {\n                            headers: {\n                                authorization: `Bearer ${window.localStorage.token}`,\n                            },\n                        }\n                    )\n                    .then((response) => {\n                        console.warn(\"message enviat\", response);\n                    })\n                    .catch(function (error) {\n                        console.error(error);\n                    })\n                    .then(() => {});\n\n                this.message = \"\";\n            }\n        },\n        populateMessages() {\n            if (this.$route.params.id != \"main\") {\n                this.axios\n                    .get(\n                        this.$store.getters[\"api\"] +\n                            \"/messages/all/\" +\n                            this.$route.params.id,\n                        {\n                            headers: {\n                                Authorization: `Bearer ${window.localStorage.token}`,\n                            },\n                        }\n                    )\n                    .then((response) => {\n                        console.warn(\"messages\", response);\n                        this.mesages = response.data.messages;\n                    })\n                    .catch(function (error) {\n                        console.error(error);\n                    })\n                    .then(() => {\n                        console.log(\"Populate messages \");\n                        //this.$refs.afterChat.scrollIntoView();\n                        this.$refs.afterChat.scrollIntoView();\n                    });\n            }\n        },\n        formatMessageData(currentDate) {\n            //return currentDate;\n            return moment(currentDate).startOf(\"minute\").fromNow();\n        },\n        showTyping() {\n            // now 'this' is referencing the Vue object and not the 'setTimeout' scope\n            this.typing++;\n            setTimeout(() => this.typing--, 500);\n        },\n        peer() {\n            this.$store.commit(\"navigateTo\", \"groups\");\n            //this.$store.commit(\"setNavbar\", false);\n            //this.$store.commit(\"setChatId\", this.$route.params.id);\n            this.$store.commit(\"refreshUser\");\n\n            this.populateMessages();\n            this.$socket.emit(\"join-room\", this.$route.params.id);\n\n            // if (this.$route.params.id != \"main\") {\n            //     this.streams = {};\n            //     navigator.mediaDevices\n            //         .getUserMedia({\n            //             video: true,\n            //             //audio: true,\n            //         })\n            //         .then((stream) => {\n            //             this.streams[\"own\"] = stream;\n            //             this.newStream = stream;\n\n            //             var peer = new Peer(\n            //                 undefined,\n            //                 this.$store.getters[\"peerObject\"]\n            //             );\n\n            //             console.log(\"Peer:\", peer, this.$peer);\n\n            //             peer.on(\"call\", (call) => {\n            //                 call.answer(stream);\n            //                 call.on(\"stream\", (userVideoStream) => {\n            //                     console.log(\"stream\");\n            //                     this.streams[\"test\"] = userVideoStream;\n            //                 });\n            //             });\n\n            //             this.sockets.subscribe(\"user-conected\", (userId) => {\n            //                 console.log(\"user conected\", userId);\n\n            //                 const call = peer.call(userId, stream);\n            //                 // peer.call(userId, stream).on(\n            //                 //     \"stream\",\n            //                 //     (userVideoStream) => {\n            //                 //         console.log(\"stream\");\n            //                 //         this.streams[userId] = userVideoStream;\n            //                 //         console.log(\"moooolt stream\");\n            //                 //     }\n            //                 // );\n\n            //                 // peer.call(userId, stream).on(\"close\", () => {\n            //                 //     console.log(\"closed\");\n            //                 // });\n\n            //                 call.on(\"stream\", (userVideoStream) => {\n            //                     console.log(\"stream\");\n            //                     this.streams[userId] = userVideoStream;\n            //                     console.log(\"moooolt stream\");\n            //                 });\n\n            //                 call.on(\"close\", () => {\n            //                     console.log(\"closed\");\n            //                     //this.streams.delete(userId);\n            //                     delete this.streams[userId];\n            //                 });\n\n            //                 this.peers[userId] = call;\n            //             });\n\n            //             this.sockets.subscribe(\n            //                 \"user-disconnected\",\n            //                 (userId) => {\n            //                     console.log(\"disconected\");\n            //                     if (this.peers[userId])\n            //                         this.peers[userId].close();\n            //                 }\n            //             );\n\n            //             peer.on(\"open\", (id) => {\n            //                 console.log(\"open peer\");\n            //                 this.$socket.emit(\"join-call\", \"call\", id); //  + this.$route.params.id\n            //             });\n            //         });\n            // }\n        },\n    },\n    mounted() {\n        this.peer();\n    },\n    updated() {\n        if (this.$route.params.id != \"main\") {\n            this.$refs.afterChat.scrollIntoView({ behavior: \"smooth\" });\n        }\n    },\n    created() {},\n    computed: {\n        chatId() {\n            return this.$route.params.id;\n            // Or return basket.getters.fruitsCount\n            // (depends on your design decisions).\n        },\n    },\n    watch: {\n        chatId(oldUser) {\n            this.$socket.emit(\"leave-room\", oldUser);\n\n            this.peer();\n        },\n    },\n};\n</script>\n\n<style scoped>\n.video-grid {\n    /* display: grid;\n    grid-template-columns: repeat(auto-fill, 520px);\n    grid-auto-rows: 400px; */\n\n    display: flex;\n    flex-wrap: wrap;\n    /* height: calc(100% - calc(var(--menu-nav-width) - 10px)); */\n    overflow: auto;\n    /* flex-flow: row;\n    flex-direction: row; */\n}\n\nvideo {\n    width: 300px;\n    height: 300px;\n    object-fit: cover;\n    border-radius: 10px;\n}\n\n.wrapper-input {\n    background-color: var(--light-dark-bg);\n    height: calc(var(--menu-nav-width) - 10px);\n    padding: 12px;\n}\n\n.input-mesage {\n    background-color: var(--light-bg);\n    border: 2px solid var(--dark-bg);\n    box-sizing: initial;\n    height: 32px;\n    color: white;\n}\n\n.input-mesage:focus {\n    border-bottom: 3px solid var(--bs-blue);\n    transition: border-bottom 0.1s;\n}\n\ntextarea:focus,\ninput:focus {\n    outline: none;\n}\n\n.user-card {\n    margin: 8px;\n    cursor: pointer;\n    border-radius: 4px;\n}\n\n.user-card:hover {\n    background-color: var(--light-dark-bg);\n}\n\n.title-name {\n    font-size: 20px;\n}\n\n.top-bar {\n    border-bottom: 2px solid var(--light-dark-bg);\n}\n\n.top-button {\n    padding: 10px;\n    padding-top: 7px;\n    border-radius: 4px;\n    cursor: pointer;\n}\n.top-button:hover {\n    background-color: var(--light-dark-bg);\n    color: var(--bs-green);\n    transition: all 0.3s;\n}\n\n.message {\n    /* border-bottom: 2px solid var(--light-dark-bg); */\n    margin-bottom: 10px;\n}\n\n.main-call {\n    z-index: 500;\n    background-color: var(--light-bg);\n}\n\n.microphone {\n    background-color: var(--light-bg);\n    width: calc(var(--menu-nav-width) - 10px);\n    padding: 12px;\n    padding-left: 15px;\n    cursor: pointer;\n}\n\n.microphone-muted {\n    color: var(--bs-red);\n}\n\n.penjar {\n    background-color: var(--bs-red);\n    width: calc(var(--menu-nav-width) - 10px);\n    padding: 12px;\n    padding-left: 13px;\n    cursor: pointer;\n}\n\n.call-bar {\n    z-index: 510;\n    margin-left: calc(var(--side-nav-width) + var(--menu-nav-width));\n    width: calc(100% - calc(var(--side-nav-width) + var(--menu-nav-width)));\n}\n\n@media (max-width: 926px) {\n    .call-bar {\n        margin-left: 0;\n        width: 100%;\n    }\n}\n</style>\n","import { render } from \"./groupsChat.vue?vue&type=template&id=6f7db287&scoped=true\"\nimport script from \"./groupsChat.vue?vue&type=script&lang=js\"\nexport * from \"./groupsChat.vue?vue&type=script&lang=js\"\n\nimport \"./groupsChat.vue?vue&type=style&index=0&id=6f7db287&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-6f7db287\"\n\nexport default script"],"sourceRoot":""}