{"version":3,"sources":["webpack:///./src/components/call.vue?32b5","webpack:///./src/components/call.vue","webpack:///./src/components/call.vue?66ef"],"names":["class","id","style","xmlns","width","height","fill","viewBox","d","fill-rule","streams","stream","i","key","srcObject","autoplay","muted","$store","getters","commit","$router","push","data","message","mesages","loading","chattingUser","image","newStream","typing","peervue","peers","userId","tempPeer","counter","tempStream","sockets","connect","console","log","newMessage","this","writing","_id","showTyping","methods","peer","chatId","navigator","mediaDevices","getUserMedia","video","audio","then","$peer","on","call","answer","currentCounter","userVideoStream","subscribe","location","reload","close","$socket","emit","$route","params","mounted","beforeUnmount","updated","created","computed","watch","newUser","oldUser","render","__scopeId"],"mappings":"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","file":"js/chunk-b68110d8.02597b06.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./call.vue?vue&type=style&index=0&id=71c4a66d&scoped=true&lang=css\"","<template>\n    <div class=\"h-100 w-100\">\n        <div\n            class=\"main-call h-100 w-100 video-grid\"\n            id=\"Dish\"\n            style=\"overflow: auto\"\n        >\n            <div v-for=\"(stream, i) in streams\" v-bind:key=\"i\">\n                <video\n                    :srcObject.prop=\"stream\"\n                    autoplay\n                    class=\"video\"\n                    :muted=\"i == 'own' ? true : false\"\n                ></video>\n            </div>\n        </div>\n        <div\n            class=\"wrapper-input p-1 d-flex fixed-bottom call-bar\"\n            style=\"flex-direction: row !important\"\n        >\n            <div class=\"flex-fill\"></div>\n\n            <div\n                v-if=\"$store.getters['micMuted']\"\n                class=\"rounded-circle me-5 microphone microphone-muted\"\n                @click=\"$store.commit('toggleMicMuted')\"\n            >\n                <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"30\"\n                    height=\"30\"\n                    fill=\"currentColor\"\n                    class=\"bi bi-mic-mute-fill\"\n                    viewBox=\"0 0 16 16\"\n                >\n                    <path\n                        d=\"M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0v1zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4zm3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3z\"\n                    />\n                    <path\n                        d=\"M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607zm-7.84-9.253 12 12 .708-.708-12-12-.708.708z\"\n                    />\n                </svg>\n            </div>\n            <div\n                v-else\n                class=\"rounded-circle me-5 microphone\"\n                @click=\"$store.commit('toggleMicMuted')\"\n            >\n                <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"30\"\n                    height=\"30\"\n                    fill=\"currentColor\"\n                    class=\"bi bi-mic-fill\"\n                    viewBox=\"0 0 16 16\"\n                >\n                    <path d=\"M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z\" />\n                    <path\n                        d=\"M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z\"\n                    />\n                </svg>\n            </div>\n            <div\n                class=\"rounded-circle penjar\"\n                @click=\"$router.push('/channels/chat/main')\"\n            >\n                <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"30\"\n                    height=\"30\"\n                    fill=\"currentColor\"\n                    class=\"bi bi-telephone-x-fill\"\n                    viewBox=\"0 0 16 16\"\n                >\n                    <path\n                        fill-rule=\"evenodd\"\n                        d=\"M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511zm9.261 1.135a.5.5 0 0 1 .708 0L13 2.793l1.146-1.147a.5.5 0 0 1 .708.708L13.707 3.5l1.147 1.146a.5.5 0 0 1-.708.708L13 4.207l-1.146 1.147a.5.5 0 0 1-.708-.708L12.293 3.5l-1.147-1.146a.5.5 0 0 1 0-.708z\"\n                    />\n                </svg>\n\n                <div class=\"flex-fill\"></div>\n            </div>\n            <div class=\"flex-fill\"></div>\n        </div>\n    </div>\n</template>\n\n<script>\n//import moment from \"moment\";\nimport Peer from \"peerjs\";\n\nexport default {\n    data: function () {\n        return {\n            message: \"\",\n            mesages: [],\n            loading: false,\n            chattingUser: {\n                image: \"default.png\",\n            },\n            streams: {},\n            newStream: null,\n            typing: 0,\n            peervue: null,\n            peers: {},\n            userId: null,\n            tempPeer: null,\n            counter: 0,\n            tempStream: null,\n        };\n    },\n    sockets: {\n        connect: function () {\n            console.log(\"socket connected\");\n        },\n        newMessage: function (data) {\n            console.log(\"el server diu\", data);\n            this.mesages.push(data);\n        },\n        writing: function (data) {\n            console.log(data);\n            if (data != this.$store.getters[\"user\"]._id) {\n                this.showTyping();\n            }\n        },\n        // \"user-conected\": function(data) {\n        //   console.log(\"user conected\", data);\n        // },\n        // \"user-conected\": function(userId) {\n        //   const call = peer.call(userId, stream);\n        //   const video = document.createElement(\"video\");\n        //   call.on(\"stream\", (userVideoStream) => {\n        //     this.streams.push(userVideoStream);\n        //   });\n        //   call.on(\"close\", () => {\n        //     video.remove();\n        //   });\n\n        //   peers[userId] = call;\n\n        //   //   call.on(\"close\", (userVideoStream) => {\n        //   //     //this.streams = [];\n        //   //     // for (const stream of this.streams) {\n        //   //     //     if (stream.userId != userId) {\n        //   //     //         this.streams.push({\n        //   //     //             stream: userVideoStream,\n        //   //     //             id: userId,\n        //   //     //         });\n        //   //     //     }\n        //   //     // }\n        //   //     console.log(userVideoStream);\n        //   //   });\n        // },\n    },\n    methods: {\n        peer() {\n            if (this.chatId != \"main\") {\n                this.streams = {};\n                navigator.mediaDevices\n                    .getUserMedia({\n                        video: true,\n                        audio: true,\n                    })\n                    .then((stream) => {\n                        this.streams[\"own\"] = stream;\n                        this.newStream = stream;\n\n                        var peer = new Peer(\n                            this.$store.getters[\"user\"]._id,\n                            this.$store.getters[\"peerObject\"]\n                        );\n\n                        this.tempPeer = peer;\n\n                        console.log(\"Peer:\", peer, this.$peer);\n\n                        peer.on(\"call\", (call) => {\n                            call.answer(stream);\n                            var currentCounter = this.counter;\n                            call.on(\"stream\", (userVideoStream) => {\n                                console.log(\"stream\");\n                                this.streams[currentCounter] = userVideoStream;\n                                this.counter++;\n                            });\n                            call.on(\"stream\", (userVideoStream) => {\n                                console.log(\"stream\");\n                                this.streams[currentCounter] = userVideoStream;\n                            });\n                        });\n\n                        this.sockets.subscribe(\"user-conected\", (userId) => {\n                            console.log(\"user conected\", userId);\n\n                            const call = peer.call(userId, stream);\n\n                            // peer.call(userId, stream).on(\n                            //     \"stream\",\n                            //     (userVideoStream) => {\n                            //         console.log(\"stream\");\n                            //         this.streams[userId] = userVideoStream;\n                            //         console.log(\"moooolt stream\");\n                            //     }\n                            // );\n\n                            // peer.call(userId, stream).on(\"close\", () => {\n                            //     console.log(\"closed\");\n                            // });\n\n                            call.on(\"stream\", (userVideoStream) => {\n                                console.log(\"stream\");\n                                this.streams[userId] = userVideoStream;\n                                console.log(\"moooolt stream\");\n                            });\n\n                            call.on(\"close\", () => {\n                                console.log(\"closed\");\n                                //this.streams.delete(userId);\n                                delete this.streams[userId];\n                            });\n\n                            this.peers[userId] = call;\n                        });\n\n                        this.sockets.subscribe(\n                            \"user-disconnected\",\n                            (userId) => {\n                                console.log(\"disconected\");\n                                location.reload();\n\n                                if (this.peers[userId])\n                                    this.peers[userId].close();\n                                delete this.streams[userId];\n                            }\n                        );\n\n                        this.sockets.subscribe(\"leaved-call\", (userId) => {\n                            console.log(\"disconected\");\n                            if (this.peers[userId]) this.peers[userId].close();\n                            delete this.streams[userId];\n                            location.reload();\n                        });\n\n                        peer.on(\"open\", (id) => {\n                            console.log(\"open peer\");\n                            this.$socket.emit(\n                                \"join-call\",\n                                \"call\" + this.$route.params.id,\n                                id\n                            ); //  + this.chatId\n                            this.userId = id;\n                            console.log(\"peer id\", id);\n                        });\n\n                        //this.tempStream = stream;\n                    });\n            }\n        },\n    },\n    mounted() {\n        this.peer();\n    },\n    beforeUnmount() {\n        // console.log(\"user id\", this.userId, this.$route.params.id);\n        // this.tempStream.getTracks().forEach(function (track) {\n        //     track.stop();\n        // });\n        this.$socket.emit(\n            \"leave-call\",\n            \"call\" + this.$route.params.id,\n            this.userId\n        );\n        // console.log(\n        //     \"teeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeemp peer\",\n        //     this.tempPeer\n        // );\n        // this.tempPeer.destroy();\n        location.reload();\n    },\n    updated() {},\n    created() {},\n    computed: {\n        chatId() {\n            return this.$store.getters[\"lastChatId\"];\n            // Or return basket.getters.fruitsCount\n            // (depends on your design decisions).\n        },\n    },\n    watch: {\n        chatId(newUser, oldUser) {\n            this.peer();\n\n            console.log(newUser, oldUser);\n        },\n    },\n};\n</script>\n\n<style scoped>\n/* .video-grid {\n    /* display: grid;\n    grid-template-columns: repeat(auto-fill, 520px);\n    grid-auto-rows: 400px; */\n/* \n    display: flex;\n    flex-wrap: wrap;\n    height: calc(100% - calc(var(--menu-nav-width) - 10px));\n    overflow: auto; */\n/* flex-flow: row;\n    flex-direction: row; \n} */\n\n.wrapper-input {\n    background-color: var(--light-dark-bg);\n    height: calc(var(--menu-nav-width) - 10px);\n    padding: 12px;\n}\n\n.input-mesage {\n    background-color: var(--light-bg);\n    border: 2px solid var(--dark-bg);\n    box-sizing: initial;\n    height: 32px;\n    color: white;\n}\n\n.input-mesage:focus {\n    border-bottom: 3px solid var(--bs-blue);\n    transition: border-bottom 0.1s;\n}\n\ntextarea:focus,\ninput:focus {\n    outline: none;\n}\n\n.user-card {\n    margin: 8px;\n    cursor: pointer;\n    border-radius: 4px;\n}\n\n.user-card:hover {\n    background-color: var(--light-dark-bg);\n}\n\n.title-name {\n    font-size: 20px;\n}\n\n.top-bar {\n    border-bottom: 2px solid var(--light-dark-bg);\n}\n\n.top-button {\n    padding: 10px;\n    padding-top: 7px;\n    border-radius: 4px;\n    cursor: pointer;\n}\n.top-button:hover {\n    background-color: var(--light-dark-bg);\n    color: var(--bs-green);\n    transition: all 0.3s;\n}\n\n.message {\n    /* border-bottom: 2px solid var(--light-dark-bg); */\n    margin-bottom: 10px;\n}\n\n.main-call {\n    z-index: 500;\n    background-color: var(--light-bg);\n}\n\n.microphone {\n    background-color: var(--light-bg);\n    width: calc(var(--menu-nav-width) - 10px);\n    padding: 12px;\n    padding-left: 15px;\n    cursor: pointer;\n}\n\n.microphone-muted {\n    color: var(--bs-red);\n}\n\n.penjar {\n    background-color: var(--bs-red);\n    width: calc(var(--menu-nav-width) - 10px);\n    padding: 12px;\n    padding-left: 13px;\n    cursor: pointer;\n}\n\n.call-bar {\n    z-index: 510;\n    margin-left: calc(var(--side-nav-width) + var(--menu-nav-width));\n    width: calc(100% - calc(var(--side-nav-width) + var(--menu-nav-width)));\n}\n\n@media (max-width: 926px) {\n    .call-bar {\n        margin-left: 0;\n        width: 100%;\n    }\n}\n\n/* Container */\n#Dish {\n    display: flex;\n    align-content: center;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: center;\n    vertical-align: middle;\n    position: absolute;\n\n    left: 0px;\n    bottom: 0px;\n    top: 0px;\n    right: 0px;\n}\n/* Camera */\n#Dish div {\n    position: relative;\n    vertical-align: middle;\n    align-self: center;\n    overflow: hidden;\n    display: inline-block;\n    animation: show 0.4s ease;\n    padding: 3px;\n}\n\n#Dish div video {\n    /* box-shadow: 0px 12px 22px rgba(0, 0, 0, 0.4); */\n    object-fit: cover;\n    border-radius: 10px;\n}\n\n@keyframes show {\n    0% {\n        opacity: 0;\n        transform: scale(0.4) translateY(20px);\n    }\n    100% {\n        opacity: 1;\n        transform: scale(1) translateY(0);\n    }\n}\n</style>\n","import { render } from \"./call.vue?vue&type=template&id=71c4a66d&scoped=true\"\nimport script from \"./call.vue?vue&type=script&lang=js\"\nexport * from \"./call.vue?vue&type=script&lang=js\"\n\nimport \"./call.vue?vue&type=style&index=0&id=71c4a66d&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-71c4a66d\"\n\nexport default script"],"sourceRoot":""}