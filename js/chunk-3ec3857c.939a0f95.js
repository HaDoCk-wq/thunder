(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ec3857c"],{"4fed":function(e,t,o){"use strict";o("607a")},5841:function(e,t,o){"use strict";o.r(t);var n=o("7a23"),c={class:"h-100 w-100"},r={class:"main-call h-100 w-100 video-grid",id:"Dish",style:{overflow:"auto"},ref:"videoGrid"},s={class:"wrapper-input p-1 d-flex fixed-bottom call-bar",style:{"flex-direction":"row !important"}},i=Object(n["i"])("div",{class:"flex-fill"},null,-1),a=Object(n["i"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fill:"currentColor",class:"bi bi-mic-mute-fill",viewBox:"0 0 16 16"},[Object(n["i"])("path",{d:"M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0v1zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4zm3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3z"}),Object(n["i"])("path",{d:"M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607zm-7.84-9.253 12 12 .708-.708-12-12-.708.708z"})],-1),l=Object(n["i"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fill:"currentColor",class:"bi bi-mic-fill",viewBox:"0 0 16 16"},[Object(n["i"])("path",{d:"M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"}),Object(n["i"])("path",{d:"M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"})],-1),d=Object(n["i"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fill:"currentColor",class:"bi bi-telephone-x-fill",viewBox:"0 0 16 16"},[Object(n["i"])("path",{"fill-rule":"evenodd",d:"M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511zm9.261 1.135a.5.5 0 0 1 .708 0L13 2.793l1.146-1.147a.5.5 0 0 1 .708.708L13.707 3.5l1.147 1.146a.5.5 0 0 1-.708.708L13 4.207l-1.146 1.147a.5.5 0 0 1-.708-.708L12.293 3.5l-1.147-1.146a.5.5 0 0 1 0-.708z"})],-1),u=Object(n["i"])("div",{class:"flex-fill"},null,-1),m=Object(n["i"])("div",{class:"flex-fill"},null,-1);function p(e,t,o,p,f,v){return Object(n["r"])(),Object(n["f"])("div",c,[Object(n["i"])("div",r,null,512),Object(n["i"])("div",s,[i,e.$store.getters["micMuted"]?(Object(n["r"])(),Object(n["f"])("div",{key:0,class:"rounded-circle me-5 microphone microphone-muted",onClick:t[1]||(t[1]=function(t){return e.$store.commit("toggleMicMuted")})},[a])):(Object(n["r"])(),Object(n["f"])("div",{key:1,class:"rounded-circle me-5 microphone",onClick:t[2]||(t[2]=function(t){return e.$store.commit("toggleMicMuted")})},[l])),Object(n["i"])("div",{class:"rounded-circle penjar",onClick:t[3]||(t[3]=function(t){return e.$router.push("/channels/chat/main")})},[d,u]),m])])}var f=o("a0bc"),v=o.n(f),h={data:function(){return{message:"",mesages:[],loading:!1,chattingUser:{image:"default.png"},streams:{},newStream:null,typing:0,peervue:null,peers:{},userId:null,tempPeer:null,counter:0,tempStream:null}},sockets:{connect:function(){console.log("socket connected")},newMessage:function(e){console.log("el server diu",e),this.mesages.push(e)},writing:function(e){console.log(e),e!=this.$store.getters["user"]._id&&this.showTyping()}},methods:{peer:function(){var e=this;this.streams={},navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(t){var o=document.createElement("video");o.muted=!0;var n=new v.a(e.$store.getters["user"]._id,e.$store.getters["peerObject"]);e.addVideoStream(o,t),e.tempPeer=n,console.warn("new peer"),console.log("Peer:",n,e.$peer),n.on("call",(function(o){o.answer(t);var n=document.createElement("video");o.on("stream",(function(t){console.warn("adding peer stream",o.peer),e.addVideoStream(n,t),e.peers[o.peer]=o})),o.on("close",(function(){console.error("removing stream"),n.remove()}))})),e.sockets.subscribe("user-conected",(function(o){e.connectToNewUser(o,t)})),e.sockets.subscribe("user-disconnected",(function(t){console.warn("disconected"),console.error("removing peer",t),e.peers[t]&&e.peers[t].close()})),e.sockets.subscribe("leaved-call",(function(t){console.warn("disconected"),e.peers[t]&&e.peers[t].close()})),n.on("open",(function(t){console.log("open peer"),e.$socket.emit("join-call","call"+e.$route.params.id,t),e.userId=t,console.log("peer id",t)}))}))},addVideoStream:function(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),this.$refs["videoGrid"].append(e)},connectToNewUser:function(e,t){var o=this,n=this.tempPeer.call(e,t),c=document.createElement("video");n.on("stream",(function(e){o.addVideoStream(c,e)})),n.on("close",(function(){console.warn("conection lost"),c.remove()})),console.error("peer",e),this.peers[e]=n},peerScreen:function(){var e=this;this.streams={},navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(t){var o=document.createElement("video");o.muted=!0,e.addVideoStream(o,t),console.warn("new peer"),console.log("Peer:",e.tempPeer),e.tempPeer.on("call",(function(o){o.answer(t);var n=document.createElement("video");o.on("stream",(function(t){console.warn("adding peer stream",o.peer),e.addVideoStream(n,t),e.peers["cast"+o.peer]=o})),o.on("close",(function(){console.error("removing stream"),n.remove()}))})),e.sockets.subscribe("user-conected",(function(o){e.connectToNewUser("cast"+o,t)})),e.sockets.subscribe("user-disconnected",(function(t){console.warn("disconected"),console.error("removing peer","cast"+t),e.peers["cast"+t]&&e.peers["cast"+t].close()})),e.sockets.subscribe("leaved-call",(function(t){console.warn("disconected"),e.peers["cast"+t]&&e.peers["cast"+t].close()})),e.tempPeer.on("open",(function(t){console.log("open peer"),e.$socket.emit("join-call","call"+e.$route.params.id,t)}))}))}},mounted:function(){this.peer()},beforeUnmount:function(){this.$socket.emit("leave-call","call"+this.$route.params.id,this.userId),console.log("temp peer disconect"),location.reload()},updated:function(){},created:function(){},computed:{chatId:function(){return this.$store.getters["lastChatId"]}},watch:{chatId:function(e,t){this.peer(),console.log(e,t)}}};o("4fed");h.render=p;t["default"]=h},"607a":function(e,t,o){}}]);
//# sourceMappingURL=chunk-3ec3857c.939a0f95.js.map